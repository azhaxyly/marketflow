üî¥ - azhaxyly
üü¶ - mromanul

üß† 1. Domain Layer (Core)

Models –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã ‚Äî –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –±–∞–∑–µ –∏–ª–∏ API

–û–ø–∏—Å–∞—Ç—å —Ç–∏–ø PriceUpdate (exchange, pair, price, timestamp) üü¶ ‚úÖ

–û–ø–∏—Å–∞—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: PriceStat (avg/min/max –∑–∞ –º–∏–Ω—É—Ç—É) üî¥ ‚úÖ

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:

PriceRepository (InsertStat, GetLatest, GetByPeriod, etc.) üü¶ ‚úÖ

Cache (SetLatest, GetLatest) üü¶ ‚úÖ

ExchangeClient (StartStreaming() –∏–ª–∏ GetUpdates(chan PriceUpdate)) üî¥ ‚úÖ

---

‚öôÔ∏è 2. Application Layer (Use Cases)

–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã domain

–°–µ—Ä–≤–∏—Å –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ –º–∏–Ω—É—Ç–∞–º (–Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç, —Å—á–∏—Ç–∞–µ—Ç avg/min/max, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤ –ë–î) üî¥

–°–µ—Ä–≤–∏—Å –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤—Ö–æ–¥—è—â–∏—Ö PriceUpdate (fan-out ‚Üí worker pool) üü¶ ‚ùì‚úÖ

–°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ (Live/Test) üü¶ ‚úÖ

REST-—Å–µ—Ä–≤–∏—Å: GetLatestPrice(symbol), GetMax(symbol, duration) –∏ —Ç.–ø. üî¥

---

üîå 3. Adapters
üíæ a) PostgreSQL (Storage Adapter) üî¥

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å PriceRepository —á–µ—Ä–µ–∑ pgx –∏–ª–∏ database/sql ‚úÖ

–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É + –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–π

–í—Å—Ç–∞–≤–∫–∞ –±–∞—Ç—á–∞–º–∏ ‚úÖ

–ó–∞–ø—Ä–æ—Å—ã min/max/avg –∑–∞ –ø–µ—Ä–∏–æ–¥ ‚úÖ

üß† b) Redis (Cache Adapter) üü¶‚úÖ

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Cache (key: latest:EX:PAIR, value: —Ü–µ–Ω–∞+–≤—Ä–µ–º—è)

–î–æ–±–∞–≤–∏—Ç—å TTL –∏ –æ—á–∏—Å—Ç–∫—É —Å—Ç–∞—Ä–æ–≥–æ

Fallback ‚Üí –µ—Å–ª–∏ Redis —É–ø–∞–ª, –Ω–µ —Ç–æ—Ä–º–æ–∑–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É

üåç c) Exchange Clients

TCP-–∫–ª–∏–µ–Ω—Ç, —á–∏—Ç–∞—é—â–∏–π –ø–æ—Ç–æ–∫ —Å 40101 / 40102 / 40103 üî¥

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–µ üî¥

–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (Test Mode): –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–µ–π–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞–Ω–∞–ª—É üü¶

---

üåê 4. HTTP API (Web Adapter)

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ö–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è: 

–ö–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏ API üü¶üî¥
API —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

GET /prices/latest/{symbol} ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–µ–Ω—É –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞.

GET /prices/latest/{exchange}/{symbol} ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–µ–Ω—É –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –±–∏—Ä–∂–∏.

GET /prices/highest/{symbol} ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–∞–º—É—é –≤—ã—Å–æ–∫—É—é —Ü–µ–Ω—É –∑–∞ –ø–µ—Ä–∏–æ–¥.

GET /prices/highest/{exchange}/{symbol} ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–∞–º—É—é –≤—ã—Å–æ–∫—É—é —Ü–µ–Ω—É –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –±–∏—Ä–∂–∏.

GET /prices/highest/{symbol}?period={duration} ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–∞–º—É—é –≤—ã—Å–æ–∫—É—é —Ü–µ–Ω—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π {duration} (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 1 —Å, 3 —Å, 5 —Å, 10 —Å, 30 —Å, 1 –º, 3 –º, 5 –º).

GET /prices/highest/{exchange}/{symbol}?period={duration} ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Å–∞–º—É—é –≤—ã—Å–æ–∫—É—é —Ü–µ–Ω—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π {duration} —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –±–∏—Ä–∂–∏.

GET /prices/lowest/{symbol} ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Å–∞–º—É—é –Ω–∏–∑–∫—É—é —Ü–µ–Ω—É –∑–∞ –ø–µ—Ä–∏–æ–¥.

GET /prices/lowest/{exchange}/{symbol} ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Å–∞–º—É—é –Ω–∏–∑–∫—É—é —Ü–µ–Ω—É –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –±–∏—Ä–∂–∏.

GET /prices/lowest/{symbol}?period={duration} ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Å–∞–º—É—é –Ω–∏–∑–∫—É—é —Ü–µ–Ω—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π {duration}.

GET /prices/lowest/{exchange}/{symbol}?period={duration} ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Å–∞–º—É—é –Ω–∏–∑–∫—É—é —Ü–µ–Ω—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π {duration} —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –±–∏—Ä–∂–∏.

GET /prices/average/{symbol} ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –∑–∞ –ø–µ—Ä–∏–æ–¥.

GET /prices/average/{exchange}/{symbol} ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –±–∏—Ä–∂–∏.

GET /prices/average/{exchange}/{symbol}?period={duration} ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ {duration} —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –±–∏—Ä–∂–∏

API Data Mode

POST /mode/test ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ).

POST /mode/live ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º).

–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

GET /health ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Redis). 

–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–û—Ç–≤–µ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

---

üîÅ 5. Concurrency: Fan-In / Fan-Out / Worker Pool üü¶

Fan-In: —Å–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å 3 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤ –æ–±—â–∏–π chan PriceUpdate

Fan-Out: –ø–µ—Ä–µ–¥–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ worker-–ø—É–ª

Worker Pool: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏ –∫–ª–∞—Å—Ç—å –≤ Redis –∏ PostgreSQL

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

---

üö¶ 6. Graceful shutdown + Logging üî¥

–û–±—Ä–∞–±–æ—Ç–∫–∞ SIGINT/SIGTERM

–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (pg, redis, –∏—Å—Ç–æ—á–Ω–∏–∫–∏)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ log/slog —Å —É—Ä–æ–≤–Ω–µ–º Info, Error, Context ‚úÖ
